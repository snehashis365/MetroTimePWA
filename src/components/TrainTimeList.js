import React, { useEffect, useState } from 'react';
import CountdownTimer from './CountdownTimer';

const trainTimings = {
  'SALT LAKE SECTOR V': ['7:00', '7:20', '7:40', '8:00', '8:20', '8:40', '9:00', '9:15', '9:30', '9:45', '10:00', '10:15', '10:30', '10:45', '11:00', '11:20', '11:40', '12:00', '12:20', '12:40', '13:00', '13:20', '13:40', '14:00', '14:20', '14:40', '15:00', '15:20', '15:40', '16:00', '16:20', '16:40', '16:52', '17:04', '17:16', '17:28', '17:40', '17:52', '18:04', '18:16', '18:28', '18:40', '18:52', '19:04', '19:16', '19:28', '19:40', '19:52', '20:00', '20:20', '20:40', '21:00', '21:20', '21:40'],
  'KARUNA MOYEE': ['7:03', '7:23', '7:43', '8:03', '8:23', '8:43', '9:03', '9:18', '9:33', '9:48', '10:03', '10:18', '10:33', '10:48', '11:03', '11:23', '11:43', '12:03', '12:23', '12:43', '13:03', '13:23', '13:43', '14:03', '14:23', '14:43', '15:03', '15:23', '15:43', '16:03', '16:23', '16:43', '17:07', '17:19', '17:31', '17:43', '17:55', '18:07', '18:19', '18:30', '18:43', '18:55', '19:07', '19:19', '19:30', '19:43', '19:55', '20:07', '20:19', '20:32', '20:52', '21:12', '21:32', '21:52'],
  'CENTRAL PARK': ['7:05', '7:25', '7:45', '8:05', '8:25', '8:45', '9:05', '9:20', '9:35', '9:50', '10:05', '10:20', '10:35', '10:50', '11:05', '11:25', '11:45', '12:05', '12:25', '12:45', '13:05', '13:25', '13:45', '14:05', '14:25', '14:45', '15:05', '15:25', '15:45', '16:05', '16:25', '16:45', '17:09', '17:21', '17:33', '17:45', '17:57', '18:09', '18:21', '18:32', '18:45', '18:57', '19:09', '19:21', '19:32', '19:45', '19:57', '20:09', '20:21', '20:34', '20:54', '21:14', '21:34', '21:54'],
  'CITY CENTER': ['7:07', '7:27', '7:47', '8:07', '8:27', '8:47', '9:07', '9:22', '9:37', '9:52', '10:07', '10:22', '10:37', '10:52', '11:07', '11:27', '11:47', '12:07', '12:27', '12:47', '13:07', '13:27', '13:47', '14:07', '14:27', '14:47', '15:07', '15:27', '15:47', '16:07', '16:27', '16:47', '17:11', '17:23', '17:35', '17:47', '17:59', '18:11', '18:23', '18:34', '18:47', '18:59', '19:11', '19:23', '19:34', '19:47', '19:59', '20:11', '20:23', '20:36', '20:56', '21:16', '21:36', '21:56'],
  'BENGAL CHEMICAL': ['7:10', '7:30', '7:50', '8:10', '8:30', '8:50', '9:10', '9:25', '9:40', '9:55', '10:10', '10:25', '10:40', '10:55', '11:10', '11:30', '11:50', '12:10', '12:30', '12:50', '13:10', '13:30', '13:50', '14:10', '14:30', '14:50', '15:10', '15:30', '15:50', '16:10', '16:30', '16:50', '17:14', '17:26', '17:38', '17:50', '18:02', '18:14', '18:26', '18:37', '18:50', '19:02', '19:14', '19:26', '19:37', '19:50', '20:02', '20:14', '20:26', '20:39', '20:59', '21:19', '21:39', '21:59'],
  'SALT LAKE STADIUM': ['7:12', '7:32', '7:52', '8:12', '8:32', '8:52', '9:12', '9:27', '9:42', '9:57', '10:12', '10:27', '10:42', '10:57', '11:12', '11:32', '11:52', '12:12', '12:32', '12:52', '13:12', '13:32', '13:52', '14:12', '14:32', '14:52', '15:12', '15:32', '15:52', '16:12', '16:32', '16:52', '17:16', '17:28', '17:40', '17:52', '18:04', '18:16', '18:28', '18:40', '18:52', '19:04', '19:16', '19:28', '19:40', '19:52', '20:04', '20:16', '20:29', '20:49', '21:09', '21:29', '21:49'],
  'PHOOL BAGAN': ['7:16', '7:36', '7:56', '8:16', '8:36', '8:56', '9:16', '9:31', '9:46', '10:01', '10:16', '10:31', '10:46', '11:01', '11:16', '11:36', '11:56', '12:16', '12:36', '12:56', '13:16', '13:36', '13:56', '14:16', '14:36', '14:56', '15:16', '15:36', '15:56', '16:16', '16:36', '16:56', '17:20', '17:32', '17:44', '17:56', '18:08', '18:20', '18:32', '18:44', '18:56', '19:08', '19:20', '19:32', '19:44', '19:56', '20:08', '20:20', '20:33', '20:53', '21:13', '21:33', '21:53'],
  'SEALDAH': ['7:20', '7:40', '8:00', '8:20', '8:40', '9:00', '9:20', '9:35', '9:50', '10:05', '10:20', '10:35', '10:50', '11:05', '11:20', '11:40', '12:00', '12:20', '12:40', '13:00', '13:20', '13:40', '14:00', '14:20', '14:40', '15:00', '15:20', '15:40', '16:00', '16:20', '16:40', '17:00', '17:20', '17:40', '18:00', '18:20', '18:40', '19:00', '19:20', '19:40', '20:00', '20:20', '20:40', '21:00', '21:20', '21:40', '22:00']
};


function getNextTrainTime(station) {
  const currentTime = new Date();
  const currentHour = currentTime.getHours();
  const currentMinutes = currentTime.getMinutes();

  const timings = trainTimings[station];
  let nextTime = null;

  for (let time of timings) {
    const [hour, minute] = time.split(':');
    if (+hour > currentHour || (+hour === currentHour && +minute > currentMinutes)) {
      nextTime = time;
      break;
    }
  }

  return nextTime ? nextTime : timings[0]; // If no next train today, return the first train time for tomorrow
}

// Function to convert 24-hour time format to 12-hour time format
function convertTo12HourFormat(time) {
    const [hours, minutes] = time.split(':');
    let hour = parseInt(hours, 10);
    const suffix = hour >= 12 ? 'PM' : 'AM';
    hour = hour % 12 || 12;
    return `${hour}:${minutes} ${suffix}`;
  }

function TrainTimeList({ selectedStation }) {
  const [nextTrainTime, setNextTrainTime] = useState('');
  useEffect(() => {
    setNextTrainTime(getNextTrainTime(selectedStation));
    const interval = setInterval(() => {
        setNextTrainTime(getNextTrainTime(selectedStation));
    }, 20000); //Setting the interval to 20 seconds

    return () => clearInterval(interval);
  }, []);

  return (
    <div>
      <h2>Next Train Time: {convertTo12HourFormat(nextTrainTime)}</h2>
      <CountdownTimer nextTrainTime={nextTrainTime} />
    </div>
  );
}

export default TrainTimeList;
